---
title: Nucel CLI Documentation
description: Complete guide to using the Nucel command-line interface
---

# Nucel CLI Documentation

The Nucel CLI provides a simple, powerful interface for deploying modern web applications to AWS without complexity.

## Installation

### Global Installation

```bash
# Using npm
npm install -g @donswayo/nucel-cli

# Using pnpm
pnpm add -g @donswayo/nucel-cli

# Using yarn
yarn global add @donswayo/nucel-cli

# Verify installation
nucel --version
```

### Local Installation

```bash
# Add to your project
pnpm add -D @donswayo/nucel-cli

# Run with npx
npx nucel deploy
```

## Commands

### `nucel deploy`

Deploy your application to AWS.

```bash
nucel deploy [options]
```

#### Options

| Option | Alias | Description | Default |
|--------|-------|-------------|---------|
| `--stack <name>` | `-s` | Stack name for deployment | `dev` |
| `--preview` | | Preview changes without deploying | `false` |
| `--verbose` | `-v` | Show detailed output | `false` |
| `--config <path>` | `-c` | Path to config file | `nucel.config.ts` |
| `--env <file>` | `-e` | Environment file to load | Auto-detected |
| `--region <region>` | `-r` | AWS region | `us-east-1` |
| `--force` | `-f` | Force deployment without confirmation | `false` |

#### Examples

```bash
# Basic deployment to dev stack
nucel deploy

# Deploy to production stack
nucel deploy --stack production

# Preview changes without deploying
nucel deploy --preview

# Deploy with specific environment file
nucel deploy --env .env.production

# Deploy to specific AWS region
nucel deploy --region eu-west-1

# Verbose output for debugging
nucel deploy --verbose
```

### `nucel destroy`

Destroy your application infrastructure.

```bash
nucel destroy [options]
```

#### Options

| Option | Alias | Description | Default |
|--------|-------|-------------|---------|
| `--stack <name>` | `-s` | Stack name to destroy | `dev` |
| `--force` | `-f` | Skip confirmation prompt | `false` |
| `--verbose` | `-v` | Show detailed output | `false` |

#### Examples

```bash
# Destroy dev stack (with confirmation)
nucel destroy

# Destroy production stack
nucel destroy --stack production

# Force destroy without confirmation
nucel destroy --force

# Destroy with verbose output
nucel destroy --verbose
```

### `nucel preview`

Preview infrastructure changes without applying them.

```bash
nucel preview [options]
```

#### Options

| Option | Alias | Description | Default |
|--------|-------|-------------|---------|
| `--stack <name>` | `-s` | Stack name to preview | `dev` |
| `--verbose` | `-v` | Show detailed output | `false` |
| `--diff` | `-d` | Show detailed diff | `true` |
| `--format <type>` | | Output format (table, json, yaml) | `table` |

#### Examples

```bash
# Preview changes for dev stack
nucel preview

# Preview production changes
nucel preview --stack production

# Preview with JSON output
nucel preview --format json
```

### `nucel list`

List all deployed stacks.

```bash
nucel list [options]
```

#### Options

| Option | Alias | Description | Default |
|--------|-------|-------------|---------|
| `--verbose` | `-v` | Show detailed stack info | `false` |
| `--format <type>` | | Output format (table, json) | `table` |

#### Examples

```bash
# List all stacks
nucel list

# List with detailed information
nucel list --verbose

# Output as JSON
nucel list --format json
```

### `nucel logs`

View application logs from CloudWatch.

```bash
nucel logs [options]
```

#### Options

| Option | Alias | Description | Default |
|--------|-------|-------------|---------|
| `--stack <name>` | `-s` | Stack name | `dev` |
| `--function <name>` | `-f` | Function name (server, image, revalidation) | `server` |
| `--tail` | `-t` | Follow log output | `false` |
| `--since <time>` | | Time range (e.g., "5m", "1h", "2d") | `10m` |
| `--filter <pattern>` | | Filter pattern | |

#### Examples

```bash
# View recent logs
nucel logs

# Tail production logs
nucel logs --stack production --tail

# View image function logs
nucel logs --function image

# Filter for errors
nucel logs --filter ERROR

# Logs from last hour
nucel logs --since 1h
```

### `nucel config`

Manage configuration.

```bash
nucel config [command] [options]
```

#### Subcommands

##### `nucel config init`

Initialize a new configuration file.

```bash
nucel config init [options]
```

Options:
- `--force`: Overwrite existing config
- `--framework <type>`: Specify framework (nextjs, sveltekit, react-router)

##### `nucel config validate`

Validate configuration file.

```bash
nucel config validate [options]
```

Options:
- `--config <path>`: Path to config file

##### `nucel config show`

Display current configuration.

```bash
nucel config show [options]
```

Options:
- `--stack <name>`: Stack name
- `--format <type>`: Output format (json, yaml)

#### Examples

```bash
# Initialize config for Next.js
nucel config init --framework nextjs

# Validate configuration
nucel config validate

# Show current config
nucel config show

# Show production config as JSON
nucel config show --stack production --format json
```

### `nucel env`

Manage environment variables.

```bash
nucel env [command] [options]
```

#### Subcommands

##### `nucel env list`

List environment variables for a stack.

```bash
nucel env list --stack <name>
```

##### `nucel env set`

Set environment variables.

```bash
nucel env set KEY=value [KEY2=value2...] --stack <name>
```

##### `nucel env unset`

Remove environment variables.

```bash
nucel env unset KEY [KEY2...] --stack <name>
```

##### `nucel env pull`

Pull environment variables to a local file.

```bash
nucel env pull --stack <name> --output <file>
```

#### Examples

```bash
# List production environment variables
nucel env list --stack production

# Set environment variables
nucel env set API_URL=https://api.example.com DATABASE_URL=postgres://... --stack production

# Remove a variable
nucel env unset OLD_API_KEY --stack production

# Pull env vars to file
nucel env pull --stack production --output .env.production
```

## Configuration File

### nucel.config.ts

Create a `nucel.config.ts` file in your project root:

```typescript
import { defineConfig } from "@donswayo/nucel-cli";

export default defineConfig({
  // Framework (auto-detected if not specified)
  framework: "nextjs", // "nextjs" | "sveltekit" | "react-router"
  
  // Build configuration
  build: {
    // Custom build command
    command: "pnpm build",
    
    // Build output directory
    outputDir: ".open-next",
    
    // Pre-build commands
    preBuild: [
      "pnpm install",
      "pnpm test",
    ],
    
    // Post-build commands
    postBuild: [
      "echo 'Build complete!'",
    ],
    
    // Environment variables for build
    env: {
      NODE_ENV: "production",
    },
  },
  
  // Deployment configuration
  deploy: {
    // AWS region
    region: "us-east-1",
    
    // Stack name prefix
    stackPrefix: "my-app",
    
    // Default stack
    defaultStack: "dev",
    
    // Stack-specific configurations
    stacks: {
      dev: {
        environment: {
          NODE_ENV: "development",
          API_URL: "https://dev-api.example.com",
        },
        lambda: {
          memory: 512,
          timeout: 10,
        },
      },
      staging: {
        environment: {
          NODE_ENV: "staging",
          API_URL: "https://staging-api.example.com",
        },
        lambda: {
          memory: 1024,
          timeout: 20,
        },
      },
      production: {
        environment: {
          NODE_ENV: "production",
          API_URL: "https://api.example.com",
        },
        lambda: {
          memory: 2048,
          timeout: 30,
          architecture: "arm64",
        },
        domain: {
          name: "app.example.com",
          certificateArn: "arn:aws:acm:us-east-1:...",
        },
      },
    },
    
    // Global Lambda configuration
    lambda: {
      architecture: "arm64",
    },
    
    // CloudFront configuration
    cloudFront: {
      priceClass: "PriceClass_100",
    },
    
    // Tags for all resources
    tags: {
      ManagedBy: "nucel",
      Project: "my-app",
    },
  },
  
  // Preview configuration
  preview: {
    // Show detailed diff
    verbose: true,
    
    // Diff format
    diffFormat: "table",
  },
  
  // Hooks
  hooks: {
    // Before build
    preBuild: async (context) => {
      console.log(`Building for stack: ${context.stack}`);
    },
    
    // After build
    postBuild: async (context) => {
      console.log(`Build completed in ${context.duration}ms`);
    },
    
    // Before deploy
    preDeploy: async (context) => {
      console.log(`Deploying to ${context.region}`);
    },
    
    // After deploy
    postDeploy: async (context) => {
      console.log(`Deployed to: ${context.outputs.url}`);
      
      // Custom notifications
      // await notifySlack(context.outputs.url);
    },
    
    // On error
    onError: async (error, context) => {
      console.error(`Deployment failed: ${error.message}`);
      // await notifyTeam(error);
    },
  },
});
```

## Environment Variables

### Auto-loading

Nucel automatically loads environment variables from:

1. `.env` - Always loaded
2. `.env.local` - Local overrides (gitignored)
3. `.env.[stack]` - Stack-specific variables
4. `.env.[stack].local` - Stack-specific local overrides

### Loading Priority

Variables are loaded in this order (later overrides earlier):

1. `.env`
2. `.env.local`
3. `.env.[stack]`
4. `.env.[stack].local`
5. System environment variables
6. CLI `--env` flag

### Example Files

```bash
# .env
API_URL=http://localhost:3000
NODE_ENV=development

# .env.production
API_URL=https://api.example.com
NODE_ENV=production
CDN_URL=https://cdn.example.com

# .env.production.local (gitignored)
DATABASE_URL=postgresql://prod-db...
SECRET_KEY=production-secret
```

## AWS Credentials

### Configuration Methods

#### 1. AWS CLI Configuration

```bash
aws configure
# Enter Access Key ID
# Enter Secret Access Key
# Enter default region
# Enter output format
```

#### 2. Environment Variables

```bash
export AWS_ACCESS_KEY_ID=your-key-id
export AWS_SECRET_ACCESS_KEY=your-secret-key
export AWS_DEFAULT_REGION=us-east-1
```

#### 3. AWS Vault (Recommended)

```bash
# Install aws-vault
brew install aws-vault

# Add profile
aws-vault add personal

# Deploy with aws-vault
aws-vault exec personal -- nucel deploy
```

#### 4. IAM Roles (EC2/ECS)

Automatically uses instance/task roles when available.

### Required Permissions

Minimum IAM permissions required:

```json
{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Effect": "Allow",
      "Action": [
        "lambda:*",
        "s3:*",
        "cloudfront:*",
        "iam:*",
        "logs:*",
        "dynamodb:*",
        "sqs:*",
        "acm:DescribeCertificate",
        "route53:*"
      ],
      "Resource": "*"
    }
  ]
}
```

## CI/CD Integration

### GitHub Actions

```yaml
name: Deploy

on:
  push:
    branches: [main]

jobs:
  deploy:
    runs-on: ubuntu-latest
    
    steps:
      - uses: actions/checkout@v3
      
      - uses: pnpm/action-setup@v2
        with:
          version: 8
      
      - uses: actions/setup-node@v3
        with:
          node-version: 22
          cache: pnpm
      
      - run: pnpm install
      
      - name: Deploy to AWS
        env:
          AWS_ACCESS_KEY_ID: ${{ secrets.AWS_ACCESS_KEY_ID }}
          AWS_SECRET_ACCESS_KEY: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
          AWS_DEFAULT_REGION: us-east-1
          PULUMI_CONFIG_PASSPHRASE: ${{ secrets.PULUMI_PASSPHRASE }}
        run: |
          npx nucel deploy --stack production --force
```

### GitLab CI

```yaml
deploy:
  image: node:22
  stage: deploy
  
  before_script:
    - corepack enable
    - pnpm install
  
  script:
    - npx nucel deploy --stack production --force
  
  variables:
    AWS_ACCESS_KEY_ID: $AWS_ACCESS_KEY_ID
    AWS_SECRET_ACCESS_KEY: $AWS_SECRET_ACCESS_KEY
    AWS_DEFAULT_REGION: us-east-1
    PULUMI_CONFIG_PASSPHRASE: $PULUMI_PASSPHRASE
  
  only:
    - main
```

## Advanced Usage

### Custom Pulumi Programs

Override the default Pulumi program:

```typescript
// nucel.config.ts
export default defineConfig({
  deploy: {
    customProgram: async (context) => {
      const { Next } = await import("@donswayo/pulumi-nextjs-aws");
      
      const site = new Next("custom-app", {
        // Custom configuration
        appPath: context.buildPath,
        environment: context.environment,
      });
      
      return {
        url: site.url,
        distributionId: site.distributionId,
      };
    },
  },
});
```

### Multi-Region Deployment

```typescript
// nucel.config.ts
export default defineConfig({
  deploy: {
    regions: ["us-east-1", "eu-west-1", "ap-southeast-1"],
    
    stacks: {
      global: {
        regions: ["us-east-1", "eu-west-1"],
        // Configuration for multi-region
      },
    },
  },
});
```

### Custom Build Steps

```typescript
// nucel.config.ts
export default defineConfig({
  build: {
    custom: async (context) => {
      // Custom build logic
      await runCommand("pnpm build:custom");
      
      // Copy files
      await copyFiles("dist", context.outputDir);
      
      // Generate metadata
      await generateMetadata(context);
    },
  },
});
```

## Troubleshooting

### Common Issues

#### 1. AWS Credentials Not Found

```
Error: AWS credentials not configured
```

**Solution:**
```bash
# Configure AWS CLI
aws configure

# Or set environment variables
export AWS_ACCESS_KEY_ID=...
export AWS_SECRET_ACCESS_KEY=...
```

#### 2. Pulumi State Lock

```
Error: the stack is currently locked
```

**Solution:**
```bash
# Cancel the lock
pulumi cancel --stack dev

# Or force unlock
pulumi stack export --stack dev | pulumi stack import --stack dev
```

#### 3. Build Failures

```
Error: Build command failed
```

**Solution:**
```bash
# Run build manually to debug
pnpm build

# Check Node version
node --version

# Clear cache
rm -rf .next .open-next node_modules
pnpm install
```

#### 4. Large Deployment Package

```
Error: Deployment package too large
```

**Solution:**
```typescript
// nucel.config.ts
export default defineConfig({
  build: {
    // Exclude unnecessary files
    exclude: [
      "**/*.test.js",
      "**/*.map",
      "**/tests/**",
    ],
  },
});
```

### Debug Mode

Enable debug output:

```bash
# Set debug environment variable
DEBUG=nucel:* nucel deploy --verbose

# Or in config
export default defineConfig({
  debug: true,
  logLevel: "debug", // "error" | "warn" | "info" | "debug"
});
```

### Getting Help

```bash
# Show help for any command
nucel --help
nucel deploy --help
nucel config --help

# Show version
nucel --version

# Check for updates
npm outdated -g @donswayo/nucel-cli
```

## Best Practices

### 1. Use Stack-Based Deployments

```bash
# Development
nucel deploy --stack dev

# Staging
nucel deploy --stack staging

# Production (with preview first)
nucel preview --stack production
nucel deploy --stack production
```

### 2. Always Preview Production Changes

```bash
# Preview before deploying
nucel preview --stack production

# Review changes, then deploy
nucel deploy --stack production
```

### 3. Use Configuration Files

Don't rely on CLI flags alone:

```typescript
// nucel.config.ts
export default defineConfig({
  // Centralized configuration
});
```

### 4. Secure Sensitive Data

```bash
# Never commit secrets
echo ".env.*.local" >> .gitignore

# Use AWS Secrets Manager
nucel env set DATABASE_URL=aws-secret://my-db-secret
```

### 5. Monitor Deployments

```bash
# Watch logs during deployment
nucel logs --tail --stack production

# Set up alerts
nucel alerts create --threshold 10 --metric errors
```

## Migration Guide

### From Vercel

```bash
# Export Vercel environment variables
vercel env pull .env.production

# Initialize Nucel config
nucel config init --framework nextjs

# Deploy
nucel deploy --stack production
```

### From Netlify

```bash
# Copy build settings to nucel.config.ts
nucel config init --framework sveltekit

# Set environment variables
nucel env set --stack production < .env

# Deploy
nucel deploy --stack production
```

### From Custom Scripts

```typescript
// Replace custom scripts with Nucel
// Before: ./deploy.sh
// After:
export default defineConfig({
  hooks: {
    preDeploy: async () => {
      // Custom logic
    },
  },
});
```